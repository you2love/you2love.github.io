<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>git - 技术博客</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="nginx/index.html"><strong aria-hidden="true">1.</strong> nginx</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="nginx/install.html"><strong aria-hidden="true">1.1.</strong> 源码安装剖析</a></li><li class="chapter-item expanded "><a href="nginx/http.html"><strong aria-hidden="true">1.2.</strong> HTTP模块</a></li><li class="chapter-item expanded "><a href="nginx/use.html"><strong aria-hidden="true">1.3.</strong> 常用技巧</a></li><li class="chapter-item expanded "><a href="nginx/rtmp.html"><strong aria-hidden="true">1.4.</strong> rtmp</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">数据库</li><li class="chapter-item expanded "><a href="memcached.html"><strong aria-hidden="true">2.</strong> memcached</a></li><li class="chapter-item expanded "><a href="redis.html"><strong aria-hidden="true">3.</strong> redis</a></li><li class="chapter-item expanded "><a href="mysql.html"><strong aria-hidden="true">4.</strong> mysql</a></li><li class="chapter-item expanded affix "><li class="part-title">编程语言</li><li class="chapter-item expanded "><a href="markdown.html"><strong aria-hidden="true">5.</strong> markdown</a></li><li class="chapter-item expanded "><a href="golang.html"><strong aria-hidden="true">6.</strong> golang</a></li><li class="chapter-item expanded "><a href="python.html"><strong aria-hidden="true">7.</strong> python</a></li><li class="chapter-item expanded "><a href="rust.html"><strong aria-hidden="true">8.</strong> rust</a></li><li class="chapter-item expanded affix "><li class="part-title">软件工具</li><li class="chapter-item expanded "><a href="git.html" class="active"><strong aria-hidden="true">9.</strong> git</a></li><li class="chapter-item expanded "><a href="docker.html"><strong aria-hidden="true">10.</strong> docker</a></li><li class="chapter-item expanded "><a href="grpc.html"><strong aria-hidden="true">11.</strong> grpc</a></li><li class="chapter-item expanded "><a href="brew.html"><strong aria-hidden="true">12.</strong> brew-酿制</a></li><li class="chapter-item expanded "><a href="gogs.html"><strong aria-hidden="true">13.</strong> gogs-代码托管</a></li><li class="chapter-item expanded "><a href="mermaid.html"><strong aria-hidden="true">14.</strong> mermaid-美人鱼</a></li><li class="chapter-item expanded "><a href="windows.html"><strong aria-hidden="true">15.</strong> windows</a></li><li class="chapter-item expanded "><a href="elastic.html"><strong aria-hidden="true">16.</strong> elastic</a></li><li class="chapter-item expanded "><a href="vim.html"><strong aria-hidden="true">17.</strong> vim</a></li><li class="chapter-item expanded "><a href="makefile.html"><strong aria-hidden="true">18.</strong> makefile</a></li><li class="chapter-item expanded "><a href="github.html"><strong aria-hidden="true">19.</strong> github</a></li><li class="chapter-item expanded "><a href="firefox.html"><strong aria-hidden="true">20.</strong> firefox</a></li><li class="chapter-item expanded "><a href="flutter.html"><strong aria-hidden="true">21.</strong> flutter</a></li><li class="chapter-item expanded "><a href="svn.html"><strong aria-hidden="true">22.</strong> svn</a></li><li class="chapter-item expanded "><a href="tesseract.html"><strong aria-hidden="true">23.</strong> tesseract</a></li><li class="chapter-item expanded "><a href="harbor.html"><strong aria-hidden="true">24.</strong> harbor</a></li><li class="chapter-item expanded "><a href="web.html"><strong aria-hidden="true">25.</strong> web</a></li><li class="chapter-item expanded "><a href="opensource.html"><strong aria-hidden="true">26.</strong> 优秀开源软件</a></li><li class="chapter-item expanded "><a href="unity.html"><strong aria-hidden="true">27.</strong> unity</a></li><li class="chapter-item expanded "><a href="et.html"><strong aria-hidden="true">28.</strong> ET框架</a></li><li class="chapter-item expanded "><a href="gitlab.html"><strong aria-hidden="true">29.</strong> gitlab</a></li><li class="chapter-item expanded "><a href="geocode.html"><strong aria-hidden="true">30.</strong> 地理编码</a></li><li class="chapter-item expanded "><a href="shell.html"><strong aria-hidden="true">31.</strong> shell</a></li><li class="chapter-item expanded "><a href="ai.html"><strong aria-hidden="true">32.</strong> ai</a></li><li class="chapter-item expanded "><a href="hugo.html"><strong aria-hidden="true">33.</strong> hugo</a></li><li class="chapter-item expanded "><a href="wireshark.html"><strong aria-hidden="true">34.</strong> wireshark</a></li><li class="chapter-item expanded affix "><li class="part-title">杂记</li><li class="chapter-item expanded "><a href="important.html"><strong aria-hidden="true">35.</strong> 重要</a></li><li class="chapter-item expanded "><a href="mac.html"><strong aria-hidden="true">36.</strong> mac</a></li><li class="chapter-item expanded "><a href="rpc.html"><strong aria-hidden="true">37.</strong> rpc</a></li><li class="chapter-item expanded "><a href="search.html"><strong aria-hidden="true">38.</strong> 搜索技巧</a></li><li class="chapter-item expanded "><a href="other.html"><strong aria-hidden="true">39.</strong> 杂项</a></li><li class="chapter-item expanded "><a href="machinelearn.html"><strong aria-hidden="true">40.</strong> 机器学习</a></li><li class="chapter-item expanded "><a href="wasm.html"><strong aria-hidden="true">41.</strong> wasm</a></li><li class="chapter-item expanded affix "><li class="part-title">大厂</li><li class="chapter-item expanded "><a href="aliyun.html"><strong aria-hidden="true">42.</strong> 阿里云</a></li><li class="chapter-item expanded "><a href="tencent.html"><strong aria-hidden="true">43.</strong> 腾讯</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">技术博客</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<h1 id="git"><a class="header" href="#git">git</a></h1>
<hr />
<h3 id="优秀文档"><a class="header" href="#优秀文档">优秀文档</a></h3>
<ul>
<li>[git-scm]<a href="https://git-scm.com/book/zh/">https://git-scm.com/book/zh/</a>)</li>
</ul>
<h3 id="文件状态变迁图"><a class="header" href="#文件状态变迁图">文件状态变迁图</a></h3>
<pre class="mermaid">
flowchart LR
    subgraph WorkDirectory
        ut(Untracked)
        um(Unmodified)--编辑修改--&gt;md(Modified)
    end
    subgraph Staged
        s(Staged/Index)
    end
    subgraph Repo
        r(Commit对象)
    end
WorkDirectory --add--&gt; Staged
Staged --restore或checkout--&gt; WorkDirectory

Staged --commit--&gt; Repo
Repo --restore或reset或checkout--&gt; Staged

</pre>
<p><img src="webp/git/git_lint.webp" alt="git_lint" /></p>
<pre class="mermaid">sequenceDiagram
    actor ut as Untracked
    actor um as Unmodified
    actor m as Modified
    actor s as Staged/Index
    actor r as Repo

    opt 未跟踪新文件
      ut-&gt;&gt;s: add 跟踪
      ut--&gt;&gt;um: 自动转为
      r--&gt;&gt;s: 放弃跟踪 restore --staged或rm --cached
      um--&gt;&gt;ut: 放弃跟踪后自动转为
    end

    opt 已跟踪
      opt 已跟踪编辑
        um-&gt;&gt;m: 编辑
        s--&gt;&gt;um: 放弃编辑 restore或checkout
      end

      opt 提交到stage/index
        m-&gt;&gt;s: add
        r--&gt;&gt;s: 放弃add restore --staged或reset
      end
      r--&gt;&gt;um: 放弃add和编辑 restore --staged --worktree或checkout head
    end
    
    opt 提交repo
      s-&gt;&gt;r: commit
      r--&gt;&gt;s: 放弃commit restore --source=HEAD~1 --staged或reset head~1
    end
    r--&gt;&gt;um: 放弃commit和add和编辑 restore --source=HEAD~1 --staged --worktree或checkout head~1或reset --hard head~1

</pre>
<h3 id="命令介绍"><a class="header" href="#命令介绍">命令介绍</a></h3>
<ul>
<li>
<p>git rm, 删除WorkDictory,Staged/Index的文件</p>
<ul>
<li>命令快照</li>
</ul>
<pre><code class="language-bash">git rm [--cached] &lt;pathspec&gt;...
</code></pre>
<ul>
<li>带上--cached，则只删除Staged/Index,否则WorkDictory也删除</li>
</ul>
</li>
<li>
<p>restore,从指定源恢复</p>
<ul>
<li>命令快照</li>
</ul>
<pre><code class="language-sh"> git restore [&lt;options&gt;] [--source=&lt;tree&gt;] [--staged] [--worktree] [--] &lt;pathspec&gt;...
</code></pre>
<ul>
<li>没有带上--staged,则直接从Staged/Index恢复到WorkDictory</li>
<li>带上--staged,则从repo(head或者source指定commit或tag)恢复到Staged/Index.如果同时要恢复WorkDictory,则带上--worktree</li>
<li>--source默认值为head</li>
<li>命令是试验性的,行为可能会改变.THIS COMMAND IS EXPERIMENTAL. THE BEHAVIOR MAY CHANGE.</li>
</ul>
</li>
<li>
<p>reset,设置head,Reset current HEAD to the specified state</p>
<ul>
<li>命令快照-格式1</li>
</ul>
<pre><code class="language-sh"> git reset [-q] [&lt;tree-ish&gt;] [--] &lt;pathspec&gt;
</code></pre>
<ul>
<li>
<p>从指定的tree-ish恢复到staged/index,tree-ish不指定就采用head</p>
</li>
<li>
<p>命令快照-格式2</p>
</li>
</ul>
<pre><code class="language-sh"> git reset [&lt;mode&gt;] [&lt;commit&gt;]
         This form resets the current branch head to &lt;commit&gt; and possibly updates the index (resetting it to the tree of &lt;commit&gt;) and the working tree depending on &lt;mode&gt;. If
         &lt;mode&gt; is omitted, defaults to --mixed. The &lt;mode&gt; must be one of the following:
</code></pre>
<ul>
<li>把head指向tree-ish</li>
<li>mode不同值不同含义
<ul>
<li>--soft,仅改动head</li>
<li>--mixed(默认值),改动head并且staged/index恢复为指定tree-ish里面,workdictory不改</li>
<li>--herd,改动head并且staged/index,workdictory恢复为指定tree-ish里面</li>
</ul>
</li>
</ul>
</li>
<li>
<p>checkout,切换分支或恢复出指定文件</p>
<ul>
<li>命令快照-格式1</li>
</ul>
<pre><code class="language-sh">git checkout [-f|--ours|--theirs|-m|--conflict=&lt;style&gt;] [&lt;tree-ish&gt;] [--] &lt;pathspec&gt;
</code></pre>
<ul>
<li>
<p>没有带上tree-ish,则直接从Staged/Index恢复到WorkDictory</p>
</li>
<li>
<p>带上tree-ish,则从repo(tree-ish)恢复到Staged/Index和WorkDictory</p>
</li>
<li>
<p>tree-ish 通常是head,commit值或tag之类</p>
</li>
<li>
<p>命令快照-格式2</p>
</li>
</ul>
<pre><code class="language-sh">git checkout [-q] [-f] [-m] [[-b|-B|--orphan] &lt;new_branch&gt;]
</code></pre>
<ul>
<li>
<p>没有带上-b,则直接切换指定分支,分支必须存在</p>
</li>
<li>
<p>带上-b,则创建新分支,并且立即切换过去</p>
</li>
<li>
<p>命令快照-格式3</p>
</li>
</ul>
<pre><code class="language-sh">#从远程仓库/分支,创建本地分支,分支名同远程分支一样,两者建立跟踪关系
#切换到新分支,简化操作
git checkout --track remoteRepo/repoBranch
</code></pre>
</li>
<li>
<p>revert返祖,产生新的提交commit来返回过去的特定提交</p>
<ul>
<li>命令快照</li>
</ul>
<pre><code class="language-sh"> git revert [--[no-]edit] [-n] [-m parent-number] [-s] [-S[&lt;keyid&gt;]] &lt;commit&gt;
 git rever -m 1 head
</code></pre>
</li>
</ul>
<pre class="mermaid">
flowchart LR
m1(commitXXXX) --commit--&gt; m2(commitYYYY)
m2 --commit--&gt; m3(commitZZZZ)
m3 --rever -m 1 head--&gt; m4(commitNNNN,但内容和commitYYYY一样)

</pre>
<ul>
<li>
<p>标签</p>
<pre><code class="language-sh">#列出标签
git tag
#查看指定标签
git show vxxx
#打轻量标签
git tag v1.0
#打附注标签
git tag -a v2.0 -m &quot;附加信息&quot;
#把标签vxxx推送到远程
git push origin vxxx
</code></pre>
</li>
<li>
<p>commit对象</p>
</li>
</ul>
<pre class="mermaid">
flowchart LR
    subgraph commitXXXX
        direction TB
        cx(CommitXXXX)--包含--&gt;tx(Tree对象)
        tx--包含--&gt;bxa(Blob对象A)
        tx--包含--&gt;bxb(Blob对象b)
        tx--包含--&gt;bxc(Blob对象c)
    end
    subgraph commitYYYY
        direction TB
        cy(commitYYYY)--包含--&gt;ty(Tree对象)
        ty--包含--&gt;by1(Blob对象1)
        ty--包含--&gt;by2(Blob对象2)
    end
    subgraph commitZZZZ
        direction TB
        cz(commitZZZZ)--包含--&gt;tz(Tree对象)
        tz--包含--&gt;bzl(Blob对象l)
        tz--包含--&gt;bzm(Blob对象m)
        tz--包含--&gt;bzn(Blob对象n)
        tz--包含--&gt;bzo(Blob对象o)
    end
commitXXXX --父对象--&gt; commitYYYY
commitYYYY --父对象--&gt; commitZZZZ

</pre>
<ul>
<li>分支</li>
</ul>
<pre><code class="language-bash">#列出分支
git branch
#查看分支详情
git branch -vv
#创建分支issue100
git branch issue100
#跳到分支issue100
git checkout issue100
#创建hotfix并且立即切过去
git checkout -b hotfix
#删除分支issue100
git branch -d issue100
#指定分支的跟踪远程分支
git branch --set-upstream-to=remote/branch branch
#基于远程分支创建新分支并设置跟踪关系
git checkout --trace -b feature origin/feature
#把hotfix分支合并到当前分支里
git merge hotfix
# 合并没有历史交并的分支
git merge gitee master --allow-unrelated-histories
#如果合并冲突,则编辑修改冲突文件,再提交
git commit -am &quot;人工修改冲突&quot;
#变基是改变-指定分支(不指出则采用当前分支)的起点,并且起点后的提交重播一次
#以hotfix分支为起点,本分支已有提交重播一次,达到合并目的
git rebase hotfix
#如果重播冲突,则编辑修改冲突文件,再提交
git commit -am &quot;人工修改冲突&quot;
#解决冲突后提交,再继续完成变基操作
git rebase --continue
</code></pre>
<p><img src="webp/git/git_rebase.webp" alt="git_rebase" /></p>
<ul>
<li>
<p>rebase变基原则</p>
<ul>
<li>只对尚未推送或分享给别人的本地修改执行变基操作清理历史.</li>
<li>从不对已推送至别处的提交执行变基操作.</li>
</ul>
</li>
<li>
<p>合并提交</p>
</li>
</ul>
<pre><code class="language-bash">git commit -am &quot;first&quot;
# 编辑修改...
git commit -am &quot;second&quot;
# 编辑修改...
git commit -am &quot;three&quot;
# 交互式合并最近三个提交,如下图所示
# 默认从上到下，从旧到新列出来,可以编辑顺序
# 合并时从上到下执行，第一个一般是pack(基础)，其他的为s(合并到基础去,pack改为s)
# 退出保存后,会继续编辑合并信息.
git rebase -i head~3
</code></pre>
<p><img src="webp/git/git_rebase_head.webp" alt="git_rebase" /></p>
<pre><code class="language-bash">git commit
git branch dev
git checkout dev
git commit
git commit
git checkout master
git commit
git commit
git commit
git merge dev
</code></pre>
<pre class="mermaid">gitGraph
  commit
  branch dev
  checkout dev
  commit
  commit
  # 默认master不存在,现在都采用main
  checkout main
  commit
  commit
  commit
  merge dev
</pre>
<ul>
<li>远程仓库</li>
</ul>
<pre class="mermaid">
flowchart LR
    subgraph 本地仓库前
      lm(master)
      ld(dev)
    end
    subgraph 远程仓库
      rm(master)
      rd(dev)
      rh(hotfix)
    end
    subgraph 本地仓库后
      am(master)
      ad(dev)

      arm(origin/master)
      ard(origin/dev)
      arh(origin/hotfix)
    end
本地仓库前 --remote add orgin--&gt; 远程仓库
本地仓库前 --fetch origin--&gt; 本地仓库后

</pre>
<pre><code class="language-sh">#添加远程库
git remote add name url
# 如果远程库有意外提交,可以强行合并进来,再推上去
git pull origin master --allow-unrelated-histories
#拉取远程库内容
git fetch name
#查看远程分支日志
git log name/branch
#创建本地分支branch并且跟踪到远程分支
git checkout --track name/branch
#推送到远程
git push
#删除远程分支
git push name -d branch
#查看本地分支与远程分支设置
git branch -vv
</code></pre>
<ul>
<li>集中式工作流程</li>
</ul>
<pre class="mermaid">sequenceDiagram
    actor da as 开发者A
    actor r as 仓库
    actor db as 开发者B

    da-&gt;&gt;r: clone

    db-&gt;&gt;r: clone

    da-&gt;&gt;da: commit

    db-&gt;&gt;db: commit

    da-&gt;&gt;r: push

    db-&gt;&gt;r: pull

    db-&gt;&gt;r: push

</pre>
<ul>
<li>pull-request工作流程,同一个仓库用不同分支替代仓库,类似流程</li>
</ul>
<pre class="mermaid">sequenceDiagram
    actor da as 开发者A
    actor dar as 开发者A仓库
    actor r as 仓库
    actor rw as 仓库维护者
    actor db as 开发者B
    actor dbr as 开发者B仓库

    opt 开发者A流程
      da-&gt;&gt;r: fork
      r--&gt;&gt;dar: 自动创建
      da-&gt;&gt;dar: clone
      da-&gt;&gt;da: commit
      da--&gt;&gt;dar: push
      dar--&gt;&gt;r: pull requestA
      dar--&gt;&gt;rw: 通知
    end

    opt 开发者B流程
      db-&gt;&gt;r: fork
      r--&gt;&gt;dbr: 自动创建
      db-&gt;&gt;dbr: clone
      db-&gt;&gt;db: commit
      db--&gt;&gt;dbr: push
      dbr--&gt;&gt;r: pull requestB
      dbr--&gt;&gt;rw: 通知
    end

    opt 仓库维护者流程
      rw-&gt;&gt;r: merge pull requestA
      rw-&gt;&gt;r: merge pull requestB
    end

</pre>
<ul>
<li>储存栈</li>
</ul>
<pre><code class="language-sh">#把workdirectory已跟踪修改+staged/index储存到一个栈上,
git stash
#可以在任何一个干净状态恢复出来,不一定需要原来保存的分支里
#不带上--index,则只恢复workdirectory已跟踪修改,
#带上--index,则staged/index也一起恢复
git stash apply [--index]
#apply可以多次重复
#删除就用drop
git stash drop
</code></pre>
<ul>
<li>杂项</li>
</ul>
<pre><code class="language-sh">#配置本项目用户
git config user.name 'username'
git config user.email 'username@xx.com'

# 配置默认的分支名称
git config --global init.defaultBranch master   

#修改最近提交的author
#amend纠正最近一次提交
#此次也会提交stage/index内容,如果stage/index没有修改,则直修改提交信息
git commit --amend --reset-author

# 查看最近3次提交文件变化情况
git log -3 --stat

#查看指定文件提交记录
git log -p filename
# 查看该文件的相关commit
git log -- filename

# 查看指定提交特定文件的变化
git show commit_id filename
# 查看指定提交的变化
git show commit_id

#比较两次提交之间指定目录的区别
git diff 26be34b 934d76fd flow/proto_file

# 有时候git status显示有变化,但是git diff没有,可能是文件换行符及文件权限属性变化了
git diff --cached filename

#当前指定提交commit值
rem 'git rev-parse --short HEAD'

#记录本项目git版本,获取当前git版本值
Cgithash=`git rev-parse --short HEAD`
#获取当前时间
Ctime=`date '+%Y-%m-%d_%H:%M:%S'`

# 强制退回指定commit
#fa2850...是commit的hash值
git reset --hard fa285014d635190e74cd40fc798ce26243766a09

#带用户名及密码的git clone
git clone http://uer:pwd@xxx.git


# 本地修改不提交到远程仓库
git update-index --skip-worktree filePath

# post-receive钩子
# git pull引入$GIT_DIR变量,因此需要取消变量
unset $(git rev-parse --local-env-vars);
git pull


# 查看特定提交在哪里分支
git branch --contains xxxx -all

# 创建一个空分支,没有任何父节点
git checkout --orphan newBranch
git rm -rf .
# 如何没有任何文件提交，看不到新建的分支
git commit -am &quot;newBranch&quot;
</code></pre>
<h3 id="积累"><a class="header" href="#积累">积累</a></h3>
<hr />
<ul>
<li>
<p><strong><a href="https://git-scm.com/">官网</a></strong></p>
</li>
<li>
<p>Git gc一般情况不用手动,gc主要把无用的内部对象回收,一般都自动处理</p>
</li>
<li>
<p>Git钩子都被存储在 Git 目录下的 hooks 子目录中.</p>
</li>
<li>
<p>.git目录内容
<img src="webp/git/git_dir.webp" alt="git_dir" /></p>
</li>
<li>
<p>git引用
<img src="webp/git/git_refs.webp" alt="git_refs" /></p>
</li>
<li>
<p>查看项目本地仓库,远程仓库,标签等</p>
</li>
</ul>
<pre><code class="language-sh">  tree .git/refs
</code></pre>
<p><img src="webp/git/git_tree_refs.webp" alt="git_tree_refs" /></p>
<ul>
<li>
<p>Git 可以使用四种不同的协议来传输资料：</p>
<ul>
<li>本地协议（Local）</li>
</ul>
<pre><code class="language-sh">#本机clone,尽量采用不带file://前缀,加快速度
git clone /srv/git/project.git
git clone file:///srv/git/project.git
</code></pre>
<ul>
<li>HTTP 协议，现在git一般采用智能 HTTP 协议</li>
</ul>
<pre><code class="language-sh">git clone https://example.com/gitproject.git
</code></pre>
<ul>
<li>SSH（Secure Shell）协议</li>
</ul>
<pre><code class="language-sh">git clone ssh://[user@]server/project.git
git clone [user@]server:project.git
</code></pre>
<ul>
<li>Git 协议
<ul>
<li>Git里的一个特殊的守护进程,它监听在一个特定的端口（9418）</li>
<li>速度最快的</li>
<li>缺乏授权机制</li>
<li>git://</li>
</ul>
</li>
</ul>
</li>
<li>
<p>利用post-receive钩子自动更新</p>
</li>
</ul>
<pre><code class="language-sh">  #!/usr/bin/env bash

  # post-receive脚本代码
  cd ~
  target=xxx
  # 简单粗暴,删除旧目录
  if [ -d ${target} ]; then
      rm -rf ${target}
  fi
  # 重新建立,从git代码库目录
  git clone gogs-repositories/yyy/${target}.git
  # 杀死进程
  pkill ${target}
  cd ${target}
  # 后台运行进程
  nohup ./${target} &gt;${target}.nohup 2&gt;&amp;1 &amp;
</code></pre>
<ul>
<li>
<p>push碰到HTTP 413</p>
<ul>
<li>问题表现</li>
</ul>
<pre><code class="language-sh">Git push error: error: RPC failed; HTTP 413 curl 22 the requested URL returned error: 413
</code></pre>
<ul>
<li>解决办法</li>
</ul>
<pre><code class="language-sh"># 增加最大http长度
git config –global http.postBuffer 524288000
</code></pre>
<pre><code class="language-nginx">location / {
  ...
  # 如果有nginx转发
  client_max_body_size 200M;
  ...
}
</code></pre>
</li>
</ul>
<h3 id="多项目-一个项目采用git管理使用另一个项目采用git管理"><a class="header" href="#多项目-一个项目采用git管理使用另一个项目采用git管理">多项目-一个项目(采用git管理)使用另一个项目(采用git管理)</a></h3>
<hr />
<ul>
<li>
<p>Git Submodule</p>
<ul>
<li>
<p>添加子目录</p>
<pre><code class="language-sh"># 默认在目录下建立repo子目录,并且克隆仓库,并且创建.gitmodules
git submodule add  https://xxx/repo.git
# 提交到仓库
git commit -am &quot;submodule&quot;

# 如果子项目有更新,直接取更新
git submodule update --remote
# 然后更新父目录,子项目引用到更新后的
git commit -am &quot;更新submodule&quot;

#可以直接在子目录修改提交,和正常git操作一样
</code></pre>
</li>
<li>
<p>其他人使用</p>
<pre><code class="language-sh"># 一次性克隆项目及子项目
git clone --recursive https://xxx/repo.git

# 或者先克隆项目
git clone  https://xxx.git
# 手动更新子项目
git submodule init
git submodule update --remote

#可以直接在子目录修改提交,和正常git操作一样
</code></pre>
</li>
<li>
<p>子项目.git目录储存到父项目的.git/modules目录
<img src="webp/git/git_submodules.webp" alt="git_submodules" /></p>
</li>
<li>
<p>用引用方式,显式操作</p>
</li>
</ul>
</li>
<li>
<p>Git Subtree</p>
<ul>
<li>
<p>添加子目录，建立与git项目的关联</p>
<pre><code class="language-sh">#-f在添加远程仓库之后，立即执行fetch
git remote add -f &lt;子仓库名&gt; &lt;子仓库地址&gt;

#–squash意思是把subtree的改动合并成一次commit，不用拉取子项目完整的历史记录。
#–prefix之后的=等号也可以用空格。
git subtree add --prefix=&lt;子目录名&gt; &lt;子仓库名&gt; &lt;分支&gt; --squash
</code></pre>
</li>
<li>
<p>从远程仓库更新子目录</p>
<pre><code class="language-sh">git fetch &lt;远程仓库名&gt; &lt;分支&gt;
git subtree pull --prefix=&lt;子目录名&gt; &lt;远程分支&gt; &lt;分支&gt; --squash
</code></pre>
</li>
<li>
<p>从子目录push到远程仓库（确认你有写权限）</p>
<pre><code class="language-sh">git subtree push --prefix=&lt;子目录名&gt; &lt;远程分支名&gt; 分支
</code></pre>
</li>
<li>
<p>用复制方式,隐式操作</p>
</li>
</ul>
</li>
<li>
<p>GitSlave</p>
</li>
</ul>
<h3 id="清除大文件"><a class="header" href="#清除大文件">清除大文件</a></h3>
<ul>
<li>
<p>采用工具</p>
</li>
<li>
<p>清理仓库大文件需要修改仓库的提交历史，git-filter-repo 是 Git 官方社区推荐的修改仓库提交历史的工具，本文介绍使用 git-filter-repo 来清理仓库大文件的方法。
<a href="https://help.aliyun.com/document_detail/369469.htm?spm=a2c4g.11186623.0.0.43d46980JHMUZq#topic-2156461">看他</a></p>
<pre><code class="language-bash">  pip3 install git-filter-repo
</code></pre>
</li>
<li>
<p>手动执行</p>
</li>
</ul>
<pre><code class="language-bash">
# 完全清除git中大文件提交
# 查看大文件
# 使用verify-pack命令查看, pack包里面的最大的10个文件对应的hash值
# 根据rev-list命令来查看, 最大的文件的文件名是什么
git rev-list --objects --all | grep &quot;$(git verify-pack -v .git/objects/pack/*.idx | sort -k 3 -n | tail -10 | awk '{print$1}')&quot;

# 删除大文件
git filter-branch --force --index-filter &quot;git rm -rf --cached --ignore-unmatch linux_x86_64/zinc_upx&quot; --prune-empty --tag-name-filter cat -- --all

# 回收空间，清理本地仓库不可达对象;
git for-each-ref --format='delete %(refname)' refs/original | git update-ref --stdin
rm -rf .git/refs/original/
rm -rf .git/logs/
git reflog expire --expire=now --all
git gc --prune=now
git gc --aggressive --prune=now

# 强制推到远程
git push origin --force --all 
# git push origin –-force --tag
git remote prune origin 

# ！！清理完之后,每个人一定要删掉之前拉取的项目, 重新从git上拉项目。不要使用之前的项目了！否则会不降反升。
</code></pre>
<h3 id="清除未跟踪文件"><a class="header" href="#清除未跟踪文件">清除未跟踪文件</a></h3>
<pre><code class="language-bash"># 清除文件
git clean -f
# 连目录也一起清除文件
git clean -fd
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="rust.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="docker.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="rust.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="docker.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>


    </body>
</html>
